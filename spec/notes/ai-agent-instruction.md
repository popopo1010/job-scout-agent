# AIエージェント使用概要書（インストラクション）

## 1. 本ドキュメントの目的

このドキュメントは、人材紹介事業AIエージェントシステムを開発・実装するAIエージェント（Claude）に対するインストラクションです。プロジェクトの全体像、各システムの要件、実装方針を明確にし、一貫性のある開発を実現します。

---

## 2. プロジェクト概要

### 2.1 プロジェクト名
**人材紹介事業 AIエージェントシステム**

### 2.2 目的
人材紹介事業における3つの課題を解決するシステムを構築する。

### 2.3 対象ドメイン
- **業種**: 人材紹介業（電気工事士の転職支援）
- **主要資格**: 電気工事士（第一種・第二種）

---

## 3. システム構成と役割

本プロジェクトは3つの独立したサブシステムで構成される。

```
┌─────────────────────────────────────────────────────────────┐
│              人材紹介事業 AIエージェントシステム              │
├───────────────┬───────────────┬─────────────────────────────┤
│  システム1     │  システム2     │  システム3                  │
│  経営分析基盤  │  フィードバック │  求人データ整備             │
│               │  システム      │                            │
├───────────────┼───────────────┼─────────────────────────────┤
│ ・期待展開率   │ ・通話分析     │ ・新規法人発見              │
│ ・適正保有件数 │ ・FB生成      │ ・新規エリア検出            │
│ ・リード振分け │ ・Slack通知   │ ・自社求人比較              │
└───────────────┴───────────────┴─────────────────────────────┘
```

---

## 4. システム別詳細

### 4.1 システム1: 経営分析基盤

**目的**: リードの期待展開率を自動計算し、意思決定を支援

**課題**:
- エリア・年齢・資格を単独でしか分析できていない
- セグメントの掛け合わせ分析ができていない

**セグメント定義（4分類）**:
| ID | 名称 | 条件 | 期待展開率 |
|----|------|------|-----------|
| A | 資格あり若手 | 電気工事士資格あり & 40歳以下 | 75% |
| B | 資格ありベテラン | 電気工事士資格あり & 40歳超 | 60% |
| C | 資格なし若手 | 電気工事士資格なし & 40歳以下 | 40% |
| D | 資格なしシニア | 電気工事士資格なし & 40歳超 | 20% |

**自動ラベリングロジック**:
```python
def assign_segment(has_qualification: bool, age: int) -> str:
    if has_qualification:
        return "A" if age <= 40 else "B"
    else:
        return "C" if age <= 40 else "D"
```

**実現機能**:
| 機能 | 説明 |
|------|------|
| セグメント自動分類 | 資格有無×年齢による4セグメント自動ラベリング |
| 適正保有件数算出 | CA一人あたりの適正保有リード件数を算出 |
| リード振り分け支援 | 期待展開率に基づいた振り分け提案 |
| パフォーマンス可視化 | 期待値vs実績のダッシュボード |

**入力データ**:
- リードデータ（年齢、資格）
- 過去の展開実績
- CA別保有リード情報

**出力**:
- セグメント別期待展開率レポート
- CA別セグメント保有状況
- 適正保有件数レポート
- リード振り分け提案

---

### 4.2 システム2: フィードバックシステム

**目的**: 営業通話を分析し、CAのスキル向上を支援

**実現機能**:
| 機能 | 説明 |
|------|------|
| 書き起こしファイル読込 | 指定ディレクトリの書き起こしテキストを読み込み |
| 内容分析 | 営業マニュアル・PSS/ADSスキル資料に基づく分析 |
| フィードバック生成 | Claude AIによるフィードバック自動生成 |
| Slack送信 | 該当CAへの自動通知 |

**使用資料**:
- CA向け営業マニュアル
- PSS（Professional Selling Skills）資料
- ADS（Adaptive Dealer Selling）スキル資料

**入力データ**:
- 書き起こし済みテキストファイル
  - 配置場所: `data/transcripts/pending/`
  - 命名規則: `{YYYY-MM-DD}_{CA_ID}_{会議識別子}.txt`

**フィードバック観点**:
- オープニング/クロージングの品質
- 顧客ニーズのヒアリング度合い
- 提案の適切性
- 反論対応の質
- 次のアクション設定

---

### 4.3 システム3: 求人データ整備

**目的**: 電気工事士求人を網羅的に収集し、新規法人・新規エリアを検出

**課題**:
1. **新規法人の見落とし**: まだ保有していない法人の求人をキャッチできていない
2. **既存法人の新規エリア見落とし**: 既存法人が新しいエリアで出している求人を把握できていない

**実現機能**:
| 機能 | 説明 |
|------|------|
| 求人サイトスクレイピング | 主要求人サイトからの電気工事士求人収集 |
| 新規法人検出 | 既存保有法人リストにない会社の求人を抽出 |
| 既存法人・新規エリア検出 | 既存法人が新エリアで出している求人を検出 |
| 自社求人比較 | 収集求人と自社保有求人を比較し、不足分を特定 |
| 定期チェック・通知 | 自動実行と発見時のSlack通知 |

**比較ロジック**:
```
収集求人 → 法人マッチング → 新規法人 → 新規法人リスト
                ↓
            既存法人 → エリア比較 → 新規エリア → 新規エリアリスト
                            ↓
                        既存エリア → 求人比較 → 不足求人リスト
```

**入力データ**:
- 既存保有法人リスト（法人名、保有エリア）
- 自社保有求人データ（法人名、エリア、求人内容）

**出力**:
- 新規法人リスト
- 既存法人・新規エリアリスト
- 不足求人レポート
- 都道府県別カバー率レポート

---

## 5. 技術スタック

| 項目 | 技術 | 備考 |
|------|------|------|
| 言語 | Python 3.11+ | |
| AIモデル | Claude (Anthropic) | フィードバック生成、データ分析 |
| データベース | SQLite（開発）/ PostgreSQL（本番） | |
| スケジューラ | APScheduler | 定期実行 |
| 通知 | Slack API | Bot Token認証 |
| スクレイピング | httpx + BeautifulSoup | |

---

## 6. ディレクトリ構成

```
job-scout-agent/
├── src/
│   ├── common/              # 共通基盤
│   │   ├── config.py        # 設定管理
│   │   ├── database.py      # DB接続
│   │   ├── logger.py        # ログ設定
│   │   └── ai_client.py     # Claude APIクライアント
│   ├── integrations/        # 外部連携
│   │   ├── slack.py         # Slack API
│   │   ├── transcript_reader.py  # 書き起こし読込
│   │   └── scraper/         # Webスクレイピング
│   ├── analytics/           # システム1: 経営分析基盤
│   ├── feedback/            # システム2: フィードバックシステム
│   └── job_data/            # システム3: 求人データ整備
├── spec/                    # 仕様書
├── tests/                   # テスト
├── config/                  # 設定ファイル
└── data/                    # データファイル
    ├── transcripts/         # 書き起こしファイル
    └── exports/             # エクスポート
```

---

## 7. 実装優先度

### Phase 1: 基盤構築
1. 共通モジュール（config, logger, database, ai_client）
2. 外部連携クライアント（Slack, TranscriptReader, Scraper基盤）

### Phase 2: 経営分析基盤
1. データモデル
2. セグメント分析ロジック
3. レポート生成

### Phase 3: フィードバックシステム
1. 書き起こしファイル処理
2. Claude AIによる分析・FB生成
3. Slack通知

### Phase 4: 求人データ整備
1. スクレイピング基盤
2. 新規法人検出・新規エリア検出
3. 自社求人比較
4. 定期チェック・通知

---

## 8. 実装時の注意事項

### 8.1 コーディング規約
- フォーマッタ: Black
- リンター: Ruff
- 型チェック: mypy（strict mode）

### 8.2 エラーハンドリング
- カスタム例外クラスを定義
- 外部API呼び出しはリトライ機構を実装

### 8.3 セキュリティ
- APIキーは環境変数で管理
- 個人情報を含むデータは適切に取り扱い

### 8.4 テスト
- pytest使用
- 外部APIはモック化

---

## 9. 確認が必要な事項

以下の点について、追加の情報や決定が必要です：

### 9.1 経営分析基盤
- [x] セグメントの具体的な定義 → **4分類（A/B/C/D）で確定**
  - A: 資格あり & 40歳以下 → 75%
  - B: 資格あり & 40歳超 → 60%
  - C: 資格なし & 40歳以下 → 40%
  - D: 資格なし & 40歳超 → 20%
- [x] 期待展開率の計算ロジック → **セグメント自動判定で確定**
- [x] 既存のリードデータ・実績データの形式 → **サンプルデータで確定**

### 9.2 フィードバックシステム
- [ ] PSS/ADSスキル資料の具体的な内容・評価基準
- [ ] フィードバックの出力フォーマット（どのような構造で出力するか）
- [ ] CA-Slack ID紐付けデータの形式

### 9.3 求人データ整備
- [ ] 対象とする求人サイトの具体的なリスト
- [x] 既存保有法人リストのデータ形式 → **サンプルデータで確定**
- [x] 自社保有求人データの形式 → **サンプルデータで確定（給与形態対応）**
  - salary_type: yearly / monthly / daily
  - 日給・月給は年収に自動換算
- [ ] 法人名マッチングのロジック（完全一致？部分一致？）
- [ ] スクレイピング頻度（週次？日次？）

### 9.4 共通
- [ ] ダッシュボードの要否と使用ツール
- [ ] 本番環境のインフラ構成

---

## 10. 関連ドキュメント

| ドキュメント | パス | 内容 |
|-------------|------|------|
| クイックスタート | `spec/00-quickstart.md` | 実装開始ガイド |
| 要件定義 | `spec/01-requirements.md` | 詳細要件 |
| ユースケース | `spec/02-use-cases.md` | 利用シナリオ |
| アーキテクチャ | `spec/03-architecture.md` | システム設計 |
| タスク一覧 | `spec/04-tasks.md` | 実装タスク |
| 実装ガイド | `spec/05-implementation-guide.md` | コーディング規約 |
| デプロイ手順 | `spec/06-deployment.md` | 環境構築 |
| 運用ガイド | `spec/07-operations.md` | 運用手順 |

---

*最終更新: 2025-11-29*
