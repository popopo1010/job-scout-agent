# 週次フィードバックレポート機能 実装提案

## 機能概要

週次でフィードバックの総括レポートを生成し、CAごとにSlackメンションをつけて自動配信します。

## 実装方針

### 1. 週次レポートの内容

#### CAごとのレポート項目
- **対象期間**: 過去7日間（月曜日〜日曜日）
- **フィードバック件数**: 週内のフィードバック生成件数
- **平均スコア**: 週内の平均スコア
- **総合評価の分布**: 優秀/良好/要改善/要指導の件数
- **繰り返し改善点**: 週内に繰り返し指摘された改善点
- **成長傾向**: 前週との比較（スコアの推移）
- **重点改善項目**: 週内で最も多く指摘された改善点

### 2. Slackメッセージフォーマット

#### 全体サマリー（チャンネル全体に配信）
```
【週次フィードバックレポート】
期間: 2025-11-24 〜 2025-11-30

■ 全体サマリー
- フィードバック生成件数: 15件
- 平均スコア: 2.8 / 4.0
- 最も多く指摘された改善点: ニーズの深掘り不足（8件）

─────────────────────────────────────
```

#### CAごとの個別レポート（メンション付き）
```
<@U0001YAMADA> 山田一郎さんの週次フィードバックレポート

【週次フィードバックレポート】
期間: 2025-11-24 〜 2025-11-30

■ 今週のフィードバック件数: 3件
■ 平均スコア: 2.9 / 4.0（前週: 2.7 → +0.2 ⬆️）

■ 総合評価の分布
- 優秀: 0件
- 良好: 2件
- 要改善: 1件
- 要指導: 0件

■ 今週最も多く指摘された改善点
1. ニーズの深掘り不足（2回）
   → 過去も2回指摘されています。根本的な改善が必要です。
2. クロージング時の期限設定が曖昧（1回）

■ 成長傾向
前週と比較して、平均スコアが0.2ポイント向上しています。
特に「オープニング」と「提案」のスコアが向上しています。

■ 今週の良かった点
- 適切な自己紹介と時間確認ができていた（3件すべてで評価）
- 具体的な求人情報を提示できていた（2件で評価）

■ 次週に向けた改善目標
最も多く指摘された「ニーズの深掘り不足」を必ず改善してください。
具体的には：
- 深掘り質問を最低3回以上実施する
- 「なぜ？」「具体的には？」を意識的に使う

期待展開率8%を実現するため、この改善は必須です。
同じ指摘を繰り返さないよう、徹底してください。

─────────────────────────────────────
```

### 3. 実装項目

1. **週次レポート生成モジュール**
   - CAごとのフィードバック集計
   - 前週との比較
   - 繰り返し改善点の検出

2. **CA-Slack IDマッピング管理**
   - CA IDとSlackユーザーIDの紐付け
   - マッピングファイルの管理

3. **Slackメンション機能**
   - ユーザーIDからメンション形式への変換
   - 個別メンション配信

4. **週次レポート配信スクリプト**
   - 自動レポート生成
   - Slack配信

5. **定期実行設定**
   - 毎週月曜日の指定時刻に自動実行

## 詳細設計

### レポート生成ロジック

#### 期間の定義
- **週の開始**: 月曜日 00:00
- **週の終了**: 日曜日 23:59:59
- **配信タイミング**: 毎週月曜日 9:00（前週の集計を配信）

#### 集計項目
1. **基本統計**
   - フィードバック件数
   - 平均スコア
   - 最高スコア/最低スコア
   - 総合評価の分布

2. **改善点の分析**
   - 改善点の頻度（何回指摘されたか）
   - 繰り返し改善点（過去のフィードバックでも指摘されたか）
   - 最も多い改善点トップ3

3. **評価項目別の分析**
   - 各PSS/ADS項目の平均スコア
   - 低評価項目の特定

4. **成長傾向**
   - 前週とのスコア比較
   - 改善した項目
   - 悪化した項目

### Slackメッセージの構成

#### 全体サマリー（チャンネル配信）
```
【週次フィードバックレポート】
期間: YYYY-MM-DD 〜 YYYY-MM-DD

■ 全体サマリー
- フィードバック生成件数: X件
- 平均スコア: X.X / 4.0
- 最も多く指摘された改善点: XXX（X件）

各CAの詳細は、以下をご確認ください。
```

#### CAごとの個別レポート（メンション付き）
```
<@SLACK_USER_ID> CA名さんの週次フィードバックレポート

【週次フィードバックレポート】
期間: YYYY-MM-DD 〜 YYYY-MM-DD

■ 今週のフィードバック件数: X件
■ 平均スコア: X.X / 4.0（前週: X.X → ±X.X ⬆️/⬇️）

■ 総合評価の分布
- 優秀: X件
- 良好: X件
- 要改善: X件
- 要指導: X件

■ 今週最も多く指摘された改善点
1. XXX（X回）
   → 過去もX回指摘されています。根本的な改善が必要です。
2. XXX（X回）

■ 成長傾向
前週と比較して、...
（スコアが向上/悪化している項目の説明）

■ 今週の良かった点
- XXX（X件すべてで評価）

■ 次週に向けた改善目標
最も多く指摘された「XXX」を必ず改善してください。
期待展開率8%を実現するため、この改善は必須です。
```

## 実装ファイル構成

```
src/feedback/
├── weekly_report.py          # 週次レポート生成モジュール（新規作成）
├── ca_mapping.py            # CA-Slack IDマッピング管理（新規作成）
└── ...

scripts/
└── generate_weekly_report.py # 週次レポート生成・配信スクリプト（新規作成）

config/
└── ca_slack_mapping.yaml     # CA-Slack IDマッピング設定ファイル（新規作成）
```

## 設定ファイル例

### config/ca_slack_mapping.yaml

```yaml
ca_slack_mappings:
  - ca_id: "FUKUYAMA"
    name: "ふくやま"
    slack_user_id: "U01234567"
  - ca_id: "CA001"
    name: "山田一郎"
    slack_user_id: "U0001YAMADA"
  - ca_id: "CA002"
    name: "佐藤二郎"
    slack_user_id: "U0002SATO"
```

または、CSVファイルから読み込む：

```csv
ca_id,name,slack_user_id
FUKUYAMA,ふくやま,U01234567
CA001,山田一郎,U0001YAMADA
CA002,佐藤二郎,U0002SATO
```

## 承認をお願いします

この実装方針で問題ないか確認をお願いします。

特に以下をご確認ください：
1. **レポート内容**: 上記の項目で問題ないか
2. **配信タイミング**: 毎週月曜日9:00で問題ないか
3. **メンション方式**: 個別にメンションして配信で問題ないか
4. **チャンネル**: `#dk_ca_ops`チャンネルに配信で問題ないか

承認いただけましたら、実装に進みます。

