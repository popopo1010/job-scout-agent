# 電気工事施工管理人材紹介システム 使用ガイド

## 概要

音声ファイルを格納し、ZoomやNottaで作成した書き起こしファイルと紐付けて、自動的にフィードバックを生成するシステムです。

**APIを使わずに実装**されており、既存のZoom書き起こし機能やNottaの書き起こし結果をそのまま活用できます。

**対象資格**: 1級・2級電気工事施工管理技士

## システム構成

```
音声ファイル → アップロード → 書き起こしファイルと紐付け → フィードバック生成
```

1. **音声ファイルのアップロード**: 音声ファイルをシステムに登録
2. **書き起こしの実施**: ZoomやNottaで手動で書き起こしを行う
3. **紐付け**: 書き起こしファイルを音声ファイルと紐付け
4. **自動フィードバック生成**: 既存システムでフィードバックを生成

## ディレクトリ構造

```
data/
└── audio_ecm/                  # 電気工事施工管理用
    ├── pending/                # 未処理の音声ファイル
    ├── processed/             # 処理完了した音声ファイル
    ├── failed/                # 処理失敗した音声ファイル
    ├── transcripts/           # 書き起こしファイル（システム管理用）
    └── audio_metadata.json    # 音声ファイルのメタデータ
```

## 使い方

### 1. 音声ファイルのアップロード

#### 方法A: ファイル名から自動抽出（推奨）

ファイル名を以下の形式にする：
```
{YYYY-MM-DD}_{CA_ID}_{会議識別子}.{拡張子}
```

例:
```bash
python scripts/upload_audio_ecm.py "2025-01-15_CA001_client-call-001.m4a"
```

#### 方法B: 手動で情報を指定

```bash
python scripts/upload_audio_ecm.py audio.m4a \
  --ca-id CA001 \
  --date 2025-01-15 \
  --meeting-id client-call-001 \
  --qualification "1級電気工事施工管理技士"
```

### 2. ZoomやNottaで書き起こしを実施

- Zoom: 録音後に「書き起こしを表示」機能を使用
- Notta: 音声ファイルをアップロードして書き起こしを実施

書き起こしファイル（.txt）をダウンロードします。

### 3. 書き起こしファイルと紐付け

```bash
python scripts/link_transcript_ecm.py \
  2025-01-15 \
  CA001 \
  client-call-001 \
  transcript.txt
```

### 4. フィードバック生成

```bash
python scripts/run_audio_feedback_ecm.py
```

または、AIを使用する場合：

```bash
python scripts/run_audio_feedback_ecm.py --use-ai
```

## 対応形式

### 音声ファイル形式
- `.m4a` (iOS録音、Zoom録音) - 推奨
- `.mp3` (一般的な音声形式)
- `.wav` (高品質音声)
- `.webm` (ブラウザ録音)
- `.mp4` (動画形式の音声)

### 書き起こしファイル形式
- `.txt` (UTF-8エンコーディング)
- 既存システムと同じ形式

## ファイル命名規則

### 音声ファイル

**推奨形式:**
```
{YYYY-MM-DD}_{CA_ID}_{会議識別子}.{拡張子}
```

**例:**
- `2025-01-15_CA001_client-call-001.m4a`
- `2025-01-15_CA002_weekly-mtg.mp3`

### 書き起こしファイル

書き起こしファイルは自動的に同じ名前で保存されます（拡張子のみ`.txt`に変更）。

## ステータス管理

音声ファイルは以下のステータスを持ちます：

- `pending`: 書き起こし待ち（アップロード直後）
- `transcript_ready`: 書き起こしファイル準備済み（紐付け後）
- `processed`: フィードバック生成完了
- `failed`: 処理失敗

## 対象資格の指定

電気工事施工管理技士の場合は、以下の資格を指定できます：

- `1級電気工事施工管理技士`
- `2級電気工事施工管理技士`

資格情報はメタデータに保存され、フィードバック生成時に活用されます。

## トラブルシューティング

### ファイルが見つからない

```bash
# 音声ファイルの一覧を確認
ls -la data/audio_ecm/pending/
```

### 書き起こしファイルを再紐付けしたい

既存の紐付けを上書きする場合は、再度 `link_transcript_ecm.py` を実行してください。

### メタデータを確認したい

```bash
cat data/audio_ecm/audio_metadata.json
```

## 既存システムとの互換性

このシステムは既存のフィードバックシステムと完全に互換性があります：

- 書き起こしファイルは `data/transcripts/pending/` にも自動的に配置されます
- 既存の `scripts/run_feedback.py` も引き続き使用可能です
- フィードバック形式は既存システムと同じです

## 今後の拡張

- Notta APIとの自動連携（将来実装予定）
- Zoom自動書き起こし取得（将来実装予定）
- Web UIでのアップロード・管理（将来実装予定）

---

*最終更新: 2025-01-15*

